   <!-- crx_donate-robust-fix.html -->
<div class="crx_donate_card" role="region" aria-label="Support this blog - donate" id="crx_donate_fragment">
  <style>
    .crx_donate_card{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;max-width:520px;margin:12px 0;padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(11,12,16,0.06);background:linear-gradient(180deg,#fff,#fbfdff);display:flex;gap:12px;align-items:center;}
    .crx_donate_qr{width:110px;height:110px;border-radius:8px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;}
    .crx_donate_qr img{width:100%;height:100%;object-fit:contain;display:block;}
    .crx_donate_meta{flex:1;min-width:0;}
    .crx_action_row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .crx_btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:700;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:#fff;color:#071022;}
    .crx_primary{background:#0b84ff;color:#fff;border:0;}
    .crx_share{background:#eef6ff;border:0;color:#064e9c;}
    .crx_upi_row{margin-top:8px;display:flex;gap:8px;align-items:center;font-weight:700;color:#0b84ff;word-break:break-all;}
    .crx_upi_text{font-size:13px;color:#071022;background:#f8fafc;padding:6px 8px;border-radius:8px;border:1px solid rgba(6,12,22,0.04);display:flex;gap:8px;align-items:center;}
    .crx_copy_icon{background:transparent;border:0;cursor:pointer;padding:6px;border-radius:6px;font-weight:700;color:#0b84ff;}
    .crx_toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:10001;background:rgba(6,12,22,0.92);color:#fff;padding:10px 14px;border-radius:8px;font-weight:700;font-size:13px;box-shadow:0 8px 24px rgba(6,12,22,0.24);opacity:0;pointer-events:none;transition:opacity .18s ease,transform .18s ease;}
    .crx_toast.visible{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(-6px);}
    @media (max-width:520px){.crx_donate_card{max-width:96%;}.crx_donate_qr{width:96px;height:96px;}}
  </style>

  <div class="crx_donate_qr" aria-hidden="false">
    <img src="https://varanasi-software-junction.github.io/blogger/blogger-assets/qr.jpg" alt="QR code to donate" loading="lazy" decoding="async" width="110" height="110" />
  </div>

  <div class="crx_donate_meta">
    <div class="crx_donate_title" style="font-weight:800;font-size:17px;color:#071022;margin-bottom:6px;">Support Learning Sutras — small donations, big impact</div>
    <div class="crx_donate_desc" style="font-size:14px;color:#6b7280;line-height:1.35;margin-bottom:8px;">If this post helped you, please consider supporting my writing. Copy the UPI ID or open the QR — thank you ❤️</div>

    <div class="crx_action_row" role="group" aria-label="Donation actions">
      <button class="crx_btn crx_primary" id="crx_pay_now" type="button" aria-label="Copy UPI ID">Copy UPI ID</button>
      <button class="crx_btn crx_share" id="crx_share" type="button" aria-label="Share donation details">Share</button>
      <a class="crx_btn" id="crx_open_qr" href="https://varanasi-software-junction.github.io/blogger/blogger-assets/qr.jpg" target="_blank" rel="noopener noreferrer" aria-label="Open QR code in new tab">Open QR — Save/Scan</a>
    </div>

    <div class="crx_upi_row" aria-hidden="false">
      <div style="font-size:13px;color:#6b7280">UPI ID:</div>
      <div id="crx_upi_text" class="crx_upi_text" role="text" aria-live="polite">
        <span id="crx_upi_value" style="user-select:text">champaksworld-1@hdfcbank</span>
        <button id="crx_copy_icon" class="crx_copy_icon" title="Copy UPI ID" aria-label="Copy UPI ID" type="button">Copy</button>
      </div>
    </div>
  </div>
</div>

<div id="crx_toast" class="crx_toast" role="status" aria-live="polite"></div>

<script>
(function(){
  'use strict';

  // CONFIG
  const UPI_ID = 'champaksworld-1@hdfcbank';
  const UPI_NAME = 'Champak Roy';
  const SHARE_MESSAGE = () => {
    const url = (typeof location !== 'undefined' && location.href) ? '\nPost: ' + location.href : '';
    return `Support ${UPI_NAME}\nUPI ID: ${UPI_ID}${url}`;
  };

  // Robust init: try immediate attach; if elements not present, poll a few times.
  const MAX_ATTEMPTS = 8;
  const ATTEMPT_INTERVAL = 250; // ms
  let attempts = 0;

  function logDebug(...args){ if(window.console) console.log('[crx-donate]', ...args); }
  function findAndBind(){
    attempts++;
    const payNowBtn = document.getElementById('crx_pay_now');
    const shareBtn = document.getElementById('crx_share');
    const copyIconBtn = document.getElementById('crx_copy_icon');
    const upiValueEl = document.getElementById('crx_upi_value');
    const toast = document.getElementById('crx_toast');

    if(!upiValueEl && attempts < MAX_ATTEMPTS){ setTimeout(findAndBind, ATTEMPT_INTERVAL); return; }
    if(!upiValueEl){ logDebug('Elements not found after retries. Aborting attach.'); return; }

    // keep visible UPI text in sync
    try { upiValueEl.textContent = UPI_ID; } catch(e){}

    // toast helper
    let toastTimer = null;
    function showToast(msg, ms=1800){
      try {
        toast.textContent = msg;
        toast.classList.add('visible');
        clearTimeout(toastTimer);
        toastTimer = setTimeout(()=> toast.classList.remove('visible'), ms);
      } catch(e){ logDebug('toast error', e); }
    }

    // robust copy: Clipboard API then fallback
    async function copyText(text){
      // ensure it's a string
      text = (typeof text === 'string') ? text : String(text);
      // Try Clipboard API
      if(navigator.clipboard && navigator.clipboard.writeText){
        try {
          await navigator.clipboard.writeText(text);
          logDebug('navigator.clipboard.writeText succeeded');
          return true;
        } catch(err){
          logDebug('navigator.clipboard.writeText failed:', err);
          // continue to fallback
        }
      }
      // Fallback: textarea + execCommand
      try {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        ta.style.top = '0';
        ta.setAttribute('readonly','');
        document.body.appendChild(ta);
        ta.select();
        ta.setSelectionRange(0, ta.value.length);
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        logDebug('execCommand copy result:', ok);
        return !!ok;
      } catch(err){
        logDebug('fallback copy failed:', err);
        return false;
      }
    }

    // Attach event listeners using both pointerdown and click for best gesture coverage
    function attachClickHandler(el, handler){
      if(!el) return;
      // ensure type=button so if inside a form button doesn't submit
      try { if(el.tagName === 'BUTTON') el.type = 'button'; } catch(e){}
      el.addEventListener('pointerdown', function pointerDown(e){ /* no-op but acts as gesture */ }, {passive:true});
      el.addEventListener('click', function(e){ e.preventDefault(); try{ handler(e); } catch(err){ logDebug('handler error', err); } });
    }

    // Primary copy button: copy UPI ID and show toast, with diagnostics if fails
    attachClickHandler(payNowBtn, async function(){
      const ok = await copyText(UPI_ID);
      if(ok) showToast('UPI ID copied to clipboard');
      else {
        showToast('Copy failed — select UPI and copy manually');
        // attempt to select the visible element to help the user
        try {
          const range = document.createRange();
          range.selectNodeContents(upiValueEl);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        } catch(ignore){}
      }
    });

    // Small copy icon next to UPI
    attachClickHandler(copyIconBtn, async function(){
      const ok = await copyText(UPI_ID);
      if(ok) showToast('UPI ID copied');
      else showToast('Copy failed');
    });

    // Share: use Web Share API on supporting browsers; else fallback to copying text
    attachClickHandler(shareBtn, async function(){
      const msg = SHARE_MESSAGE();
      if(navigator.share){
        try {
          await navigator.share({ title: `Support ${UPI_NAME}`, text: msg, url: (location && location.href) ? location.href : undefined });
          showToast('Share sheet opened');
          return;
        } catch(err){
          // user cancelled or error — fallback
          logDebug('navigator.share error/cancel:', err);
        }
      }
      // fallback copy
      const ok = await copyText(msg);
      if(ok) showToast('Share text copied — paste to share');
      else showToast('Share failed — copy UPI ID manually');
    });

    // Accessibility: keyboard support is native for buttons

    // Diagnostics: if clipboard API is not available at all, notify devs in console and show small tip
    if(!(navigator.clipboard && navigator.clipboard.writeText)){
      logDebug('navigator.clipboard.writeText is not available on this page (secure context required / older browser). Falling back to execCommand copy.');
      // Show a one-time non-intrusive toast for devs/users on first load in session (optional)
      if(!sessionStorage.getItem('crx_clipboard_warned')){
        sessionStorage.setItem('crx_clipboard_warned','1');
        showToast('Note: clipboard API unavailable — using fallback copy', 2400);
      }
    }

    logDebug('crx-donate: handlers attached successfully');
  } // findAndBind

  // Start immediate attempt
  findAndBind();

})();
</script>  
    