<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CNBC-style Teaching Demo</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#0ea5ff;
      --glass: rgba(255,255,255,0.03);
      --card-shadow: 0 12px 30px rgba(2,6,23,0.8);
    }
    *{box-sizing:border-box;font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      margin:0;
      background:linear-gradient(180deg,#071025 0%, #07172a 60%);
      color:#e6eef8;
      min-height:100vh;
      padding:18px;
      display:flex;
      gap:18px;
      align-items:flex-start;
      justify-content:center;
    }

    /* Layout */
    .stage{
      width:1100px;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:18px;
      align-items:start;
    }

    /* Left column: presenter + controls */
    .left-panel{
      background:var(--panel);
      border-radius:14px;
      padding:14px;
      box-shadow:var(--card-shadow);
      width:420px;
    }

    /* 3D round webcam card */
    .cam-wrap{
      perspective:1000px;
      width:100%;
      display:flex;
      justify-content:center;
      margin-bottom:12px;
    }
    .cam-card{
      width:320px;
      height:320px;
      border-radius:50%;
      position:relative;
      transform-style:preserve-3d;
      transition: transform 0.15s ease;
      box-shadow: 0 10px 30px rgba(2,10,23,0.9), inset 0 -8px 30px rgba(0,0,0,0.45);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border: 4px solid rgba(255,255,255,0.04);
    }
    .cam-card video, .cam-card img{
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:50%;
      transform: translateZ(40px) scale(1.02);
    }
    /* subtle rim glow */
    .cam-card::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:50%;
      box-shadow: 0 0 40px rgba(14,165,255,0.12), inset 0 80px 120px rgba(255,255,255,0.02);
      pointer-events:none;
    }

    /* small controls */
    .controls{display:flex;gap:8px;flex-wrap:wrap;}
    .controls button{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      backdrop-filter: blur(4px);
    }
    .controls input[type=file]{display:none;}

    /* Right column: main broadcast area */
    .right-panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      border-radius:12px;
      padding:12px;
      box-shadow:var(--card-shadow);
      min-height:420px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .broadcast-top{
      display:flex;
      gap:12px;
      align-items:start;
    }
    .broadcast-main{
      flex:1;
      display:flex;
      gap:12px;
    }
    .canvas{
      flex:1;
      border-radius:10px;
      background:rgba(0,0,0,0.25);
      padding:12px;
      min-height:240px;
      position:relative;
      overflow:hidden;
    }
    /* text overlay */
    .overlay {
      position:absolute;
      left:12px;
      bottom:12px;
      background:linear-gradient(90deg, rgba(2,6,23,0.6), rgba(14,165,255,0.08));
      padding:10px 12px;
      border-radius:8px;
      font-weight:600;
      font-size:14px;
      color:#eaf6ff;
      backdrop-filter: blur(6px);
    }

    .sidebar{
      width:260px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .panel{
      background:rgba(255,255,255,0.02);
      border-radius:10px;
      padding:10px;
    }

    /* small nice list */
    .thumb{
      height:68px;
      border-radius:8px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,0.02);
      border:1px dashed rgba(255,255,255,0.03);
      cursor:pointer;
    }

    footer{margin-top:12px;font-size:12px;color:rgba(230,238,248,0.6);}

    /* responsive */
    @media (max-width:1150px){
      body{padding:12px}
      .stage{width:100%;grid-template-columns:1fr;}
      .sidebar{width:100%}
    }
  </style>
</head>
<body>

  <div class="stage">
    <div class="left-panel">
      <div class="cam-wrap">
        <div class="cam-card" id="camCard" title="Move mouse here to tilt">
          <video id="webcam" autoplay muted playsinline></video>
        </div>
      </div>

      <div class="controls">
        <button id="btnWebcam">Start Webcam</button>
        <button id="btnScreen">Share Screen</button>
        <label class="thumb" title="Upload image to show">
          <input id="imgUpload" type="file" accept="image/*">
          Upload Image
        </label>
        <button id="btnHide">Hide Picture/Chart</button>
      </div>

      <div style="height:12px"></div>

      <div class="panel">
        <strong>Quick tips</strong>
        <ul style="margin:8px 0 0 16px;line-height:1.45;color:rgba(230,238,248,0.85)">
          <li>Use <em>Share Screen</em> to show code or slides.</li>
          <li>Click thumbnails on the right to switch content.</li>
          <li>For multi-user calls, use Jitsi / Zoom and use OBS as a studio feed.</li>
        </ul>
      </div>

      <footer>Demo • Local only • Use https on production</footer>
    </div>

    <div class="right-panel">
      <div class="broadcast-top">
        <div style="flex:1">
          <div style="display:flex;gap:12px;align-items:center">
            <h2 style="margin:0">Live: Programming Essentials</h2>
            <div style="padding:6px 8px;border-radius:8px;background:rgba(14,165,255,0.12);color:var(--accent);font-weight:700">LIVE</div>
          </div>
          <p style="margin:6px 0 0 0;color:rgba(230,238,248,0.7)">Instructor: You • Topic: Sorting algorithms</p>
        </div>

        <div class="sidebar">
          <div class="panel">Thumbnails (click)</div>
          <div class="panel" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="thumb" id="showChart">Chart</div>
            <div class="thumb" id="showText">Ticker Text</div>
            <div class="thumb" id="showImage">Image</div>
            <div class="thumb" id="showWebcam">Webcam</div>
          </div>
        </div>
      </div>

      <div class="broadcast-main">
        <div class="canvas" id="canvas">
          <div id="contentArea" style="width:100%;height:100%;position:relative">
            <!-- Chart container -->
            <canvas id="myChart" style="max-width:100%;max-height:100%;display:none"></canvas>

            <!-- Image -->
            <img id="mainImage" src="" style="max-width:100%;max-height:100%;display:none;object-fit:contain"/>

            <!-- Ticker / text overlay -->
            <div id="ticker" class="overlay" style="display:none">Welcome to today's lesson: Quick sorts and explanations.</div>
          </div>
        </div>

        <div style="width:240px;display:flex;flex-direction:column;gap:8px">
          <div class="panel">
            <strong>Chat (local)</strong>
            <div id="chatBox" style="height:160px;overflow:auto;margin-top:8px;background:rgba(0,0,0,0.15);padding:8px;border-radius:6px"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="chatInput" placeholder="Type..." style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit"/>
              <button id="sendChat">Send</button>
            </div>
          </div>

          <div class="panel">
            <strong>Actions</strong>
            <div style="display:flex;flex-direction:column;gap:6px;margin-top:8px">
              <button id="btnRecord" disabled>Record (use OBS for production)</button>
              <button id="btnSnapshot">Snapshot Canvas</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Elements
  const btnWebcam = document.getElementById('btnWebcam');
  const btnScreen = document.getElementById('btnScreen');
  const video = document.getElementById('webcam');
  const camCard = document.getElementById('camCard');
  const imgUpload = document.getElementById('imgUpload');
  const mainImage = document.getElementById('mainImage');
  const myChartCanv = document.getElementById('myChart');
  const ticker = document.getElementById('ticker');
  const contentArea = document.getElementById('contentArea');
  const btnHide = document.getElementById('btnHide');
  const chatBox = document.getElementById('chatBox');
  const chatInput = document.getElementById('chatInput');
  const sendChat = document.getElementById('sendChat');
  const showChart = document.getElementById('showChart');
  const showText = document.getElementById('showText');
  const showImage = document.getElementById('showImage');
  const showWebcam = document.getElementById('showWebcam');
  const btnSnapshot = document.getElementById('btnSnapshot');

  let localStream = null;
  let screenStream = null;
  let chart = null;

  // Webcam start
  btnWebcam.onclick = async () => {
    if (localStream) {
      stopTracks(localStream);
      localStream = null;
      video.srcObject = null;
      btnWebcam.textContent = 'Start Webcam';
      return;
    }
    try {
      const s = await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720}, audio:true});
      localStream = s;
      video.srcObject = s;
      btnWebcam.textContent = 'Stop Webcam';
    } catch (e) {
      alert('Webcam permission denied or not available: ' + e.message);
    }
  };

  // Screen share
  btnScreen.onclick = async () => {
    try {
      if (screenStream) { stopTracks(screenStream); screenStream = null; btnScreen.textContent = 'Share Screen'; return; }
      const s = await navigator.mediaDevices.getDisplayMedia({video:true, audio:false});
      screenStream = s;
      // show the screen capture in main area
      const [track] = s.getVideoTracks();
      const el = document.createElement('video');
      el.autoplay = true; el.playsInline = true;
      el.srcObject = new MediaStream([track]);
      el.style.width='100%'; el.style.height='100%'; el.style.objectFit='contain';
      // hide other content and show this
      hideAllContent();
      contentArea.appendChild(el);
      el.onloadedmetadata = ()=> el.play();
      btnScreen.textContent = 'Stop Screen';
      track.onended = () => { if (el.parentNode) el.parentNode.removeChild(el); btnScreen.textContent='Share Screen'; }
    } catch (e) {
      console.warn(e);
      alert('Screen share failed or was cancelled.');
    }
  };

  // Utility: stop all tracks in a stream
  function stopTracks(s){
    if (!s) return;
    s.getTracks().forEach(t => t.stop());
  }

  // Upload image and show
  imgUpload.onchange = (ev) => {
    const f = ev.target.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    mainImage.src = url;
    hideAllContent();
    mainImage.style.display = 'block';
    ticker.style.display = 'none';
  };

  // Thumbnails
  showChart.onclick = () => { showChartArea(); }
  showText.onclick = () => { hideAllContent(); ticker.style.display='block'; animateTicker(); }
  showImage.onclick = () => {
    if (!mainImage.src) {
      alert('Upload an image from left panel first.');
      return;
    }
    hideAllContent(); mainImage.style.display='block';
  }
  showWebcam.onclick = () => {
    hideAllContent();
    // show the webcam feed in content area (a clone)
    if (localStream) {
      const v = document.createElement('video');
      v.autoplay = true; v.playsInline = true; v.muted = true;
      v.srcObject = localStream;
      v.style.width='100%'; v.style.height='100%'; v.style.objectFit='cover';
      contentArea.appendChild(v);
    } else alert('Start webcam from left panel first.');
  }

  // Hide all content in content area
  function hideAllContent(){
    // remove dynamically appended videos
    Array.from(contentArea.querySelectorAll('video')).forEach(el=>{
      if (el !== video) el.remove();
    });
    // hide static items
    myChartCanv.style.display='none';
    mainImage.style.display='none';
    ticker.style.display='none';
  }

  // Chart.js example
  function showChartArea(){
    hideAllContent();
    myChartCanv.style.display='block';
    if (!chart){
      chart = new Chart(myChartCanv.getContext('2d'), {
        type:'bar',
        data:{
          labels:['Bubble','Selection','Insertion','Merge','Quick'],
          datasets:[{
            label:'Average Time (ms)',
            data:[350,220,180,70,40],
            borderWidth:1
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{display:false}},
          scales:{ y:{ beginAtZero:true } }
        }
      });
    } else chart.update();
  }

  // Ticker animation (text)
  function animateTicker(){
    ticker.style.display='block';
    const texts = [
      'Welcome: Today we cover QuickSort — visualizations coming up.',
      'Pro tip: write tests for edge cases — empty array, duplicate values.',
      'Shortcuts: Press "Share Screen" to show your IDE.'
    ];
    let i=0;
    ticker.textContent = texts[i];
    const iv = setInterval(()=> {
      i = (i+1) % texts.length;
      ticker.textContent = texts[i];
    }, 3500);
    // stop after some time or when hidden
    ticker._interval = iv;
  }

  // Hide button
  btnHide.onclick = ()=>{ hideAllContent(); if (ticker._interval) { clearInterval(ticker._interval); } }

  // Chat local (demo)
  sendChat.onclick = ()=> {
    const txt = chatInput.value.trim();
    if (!txt) return;
    const line = document.createElement('div');
    const now = new Date().toLocaleTimeString();
    line.textContent = `[You • ${now}] ${txt}`;
    chatBox.appendChild(line);
    chatBox.scrollTop = chatBox.scrollHeight;
    chatInput.value='';
  }

  // Interactive cam-card tilt
  camCard.addEventListener('mousemove', (e) => {
    const rect = camCard.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = e.clientX - cx;
    const dy = e.clientY - cy;
    const rx = (-dy / rect.height) * 20; // rotate X
    const ry = (dx / rect.width) * 20; // rotate Y
    camCard.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) scale(1.01)`;
  });
  camCard.addEventListener('mouseleave', ()=> camCard.style.transform = '');

  // Snapshot canvas
  btnSnapshot.onclick = () => {
    // capture canvas area as image
    html2canvas(contentArea).then(canvasImg => {
      const data = canvasImg.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = data;
      link.download = 'snapshot.png';
      link.click();
    }).catch(e=>alert('Snapshot needs html2canvas library. See console.'))
  };

  // tiny helper: lazy load html2canvas when snapshot is used
  document.getElementById('btnSnapshot').addEventListener('click', async ()=>{
    if (window.html2canvasLoaded) return;
    const s = document.createElement('script');
    s.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
    document.body.appendChild(s);
    s.onload = ()=> window.html2canvasLoaded = true;
  });

  // load a simple placeholder webcam image if webcam isn't started
  (function loadPlaceholder(){
    video.style.background = 'linear-gradient(180deg,#2b3745,#0b1220)';
  })();

  // auto show chart on load
  showChartArea();
</script>
</body>
</html>
