<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Face Attendance â€“ TensorFlow.js BlazeFace</title>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>

<!-- BlazeFace model -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>

<style>
    body {
        background: #fff4d0;
        font-family: system-ui, sans-serif;
        text-align: center;
        padding: 20px;
        color: #4b2e00;
    }
    #canvas {
        border: 4px solid #d49800;
        border-radius: 14px;
        margin-top: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    button {
        font-size: 18px;
        padding: 12px 26px;
        margin: 10px;
        border-radius: 10px;
        background: #ffa726;
        color: #4b2e00;
        font-weight: bold;
        border: none;
        cursor: pointer;
    }
    #count {
        margin-top: 20px;
        font-size: 28px;
        font-weight: bold;
        background: #ffe5b1;
        display: inline-block;
        padding: 10px 40px;
        border-radius: 10px;
        border: 2px solid #c78500;
    }
</style>
</head>

<body>

<h2>Face Attendance (TensorFlow.js BlazeFace)</h2>

<button id="startBtn">Start Detector</button>
<button id="stopBtn">Stop Detector</button>

<br>

<canvas id="canvas" width="640" height="480"></canvas>
<div id="count">Faces Detected: 0</div>

<script>
let model = null;
let running = false;
let video = null;
let stream = null;

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// -------------------- START DETECTOR --------------------
async function startDetector() {
    if (running) return;
    running = true;

    if (!model) {
        model = await blazeface.load();
    }

    video = document.createElement("video");
    stream = await navigator.mediaDevices.getUserMedia({ video: true });

    video.srcObject = stream;
    await video.play();

    detectLoop();
}

// -------------------- STOP DETECTOR --------------------
function stopDetector() {
    running = false;
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById("count").innerText = "Faces Detected: 0";
}

// -------------------- DETECTION LOOP --------------------
async function detectLoop() {
    if (!running) return;

    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const predictions = await model.estimateFaces(video, false);

    ctx.lineWidth = 3;
    ctx.strokeStyle = "#ff9800";

    predictions.forEach(pred => {
        const [x, y] = pred.topLeft;
        const [x2, y2] = pred.bottomRight;

        ctx.strokeRect(x, y, x2 - x, y2 - y);
    });

    document.getElementById("count").innerText =
        "Faces Detected: " + predictions.length;

    requestAnimationFrame(detectLoop);
}

// Buttons
document.getElementById("startBtn").onclick = startDetector;
document.getElementById("stopBtn").onclick = stopDetector;

</script>

</body>
</html>
